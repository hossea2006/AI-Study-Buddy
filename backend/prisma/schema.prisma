generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Flashcard {
  id              String            @id @default(uuid())
  question        String
  answer          String
  userId          String
  studyMaterialId String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  StudyMaterial   StudyMaterial?    @relation(fields: [studyMaterialId], references: [id], onDelete: Cascade)
  User            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  FlashcardReview FlashcardReview[]
}

model FlashcardReview {
  id          String    @id @default(uuid())
  flashcardId String
  quality     Int
  nextReview  DateTime
  repetitions Int       @default(0)
  easeFactor  Float     @default(2.5)
  interval    Int       @default(0)
  createdAt   DateTime  @default(now())
  Flashcard   Flashcard @relation(fields: [flashcardId], references: [id], onDelete: Cascade)
}

model Progress {
  id                 String   @id @default(uuid())
  userId             String
  date               DateTime @default(now())
  studyMinutes       Int
  flashcardsReviewed Int      @default(0)
  quizzesTaken       Int      @default(0)
  avgQuizScore       Float?
  User               User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, date])
}

model Quiz {
  id              String         @id @default(uuid())
  title           String
  userId          String
  studyMaterialId String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  StudyMaterial   StudyMaterial? @relation(fields: [studyMaterialId], references: [id], onDelete: Cascade)
  User            User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  QuizAttempt     QuizAttempt[]
  QuizQuestion    QuizQuestion[]
}

model QuizAnswer {
  id           String       @id @default(uuid())
  attemptId    String
  questionId   String
  userAnswer   String
  isCorrect    Boolean
  answeredAt   DateTime     @default(now())
  QuizAttempt  QuizAttempt  @relation(fields: [attemptId], references: [id], onDelete: Cascade)
  QuizQuestion QuizQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)
}

model QuizAttempt {
  id             String       @id @default(uuid())
  quizId         String
  score          Int
  totalQuestions Int
  completedAt    DateTime     @default(now())
  QuizAnswer     QuizAnswer[]
  Quiz           Quiz         @relation(fields: [quizId], references: [id], onDelete: Cascade)
}

model QuizQuestion {
  id            String       @id @default(uuid())
  quizId        String
  question      String
  options       String[]
  correctAnswer String
  explanation   String?
  createdAt     DateTime     @default(now())
  QuizAnswer    QuizAnswer[]
  Quiz          Quiz         @relation(fields: [quizId], references: [id], onDelete: Cascade)
}

model StudyMaterial {
  id        String      @id @default(uuid())
  title     String
  content   String
  fileUrl   String?
  fileType  String?
  userId    String
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt
  Flashcard Flashcard[]
  Quiz      Quiz[]
  User      User        @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model StudySession {
  id        String    @id @default(uuid())
  userId    String
  topic     String
  duration  Int
  startTime DateTime  @default(now())
  endTime   DateTime?
  notes     String?
  User      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model User {
  id            String          @id @default(uuid())
  email         String          @unique
  password      String
  name          String
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  Flashcard     Flashcard[]
  Progress      Progress[]
  Quiz          Quiz[]
  StudyMaterial StudyMaterial[]
  StudySession  StudySession[]
}
